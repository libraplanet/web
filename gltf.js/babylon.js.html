<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>babylon.js</title>
		<script src="res/babylon.max.js"></script> 
		<!-- <script src="res/babylon.gui.js"></script> -->
		<script src="res/babylon.gui.min.js"></script> 
		<!-- <script src="res/babylon.glTFFileLoader.js"></script> -->
		<script src="res/babylon.glTFFileLoader.min.js"></script> 
		<script type="text/javascript">
			window.onload = function() {
				var createScene = function(engine) {
					var scene = new BABYLON.Scene(engine);
					var camera;
					var defCameraTgt = new BABYLON.Vector3(0, 0, 0);
					var defCameraPos = new BABYLON.Vector3(8, 5, 8);

					// camera
					(function() {
						//var camera = new BABYLON.UniversalCamera('camera', new BABYLON.Vector3(0, 5, -10), scene);
						//camera.setTarget(BABYLON.Vector3.Zero());
						// Parameters: alpha, beta, radius, target position, scene
						camera = new BABYLON.ArcRotateCamera("camera", 0, 0, 1, defCameraTgt, scene);
						// Positions the camera overwriting alpha, beta, radius
						camera.setPosition(defCameraPos);
						camera.attachControl(canvas, true);
						camera.lowerRadiusLimit = 1;
						camera.upperRadiusLimit = 1000;
						camera.wheelDeltaPercentage = 0.01;
						camera.pinchdeltapercentage = 0.01;
					})();

					// light
					(function() {
						var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene);
					})();

					//// sphere
					//(function() {
					//	var sphere = BABYLON.Mesh.CreateSphere('sphere1', 16, 2, scene, false, BABYLON.Mesh.FRONTSIDE);
					//	sphere.position.y = 1;
					//})();

					//// ground 
					//(function() {
					//	 var ground = BABYLON.Mesh.CreateGround('ground1', 6, 6, 2, scene, false);
					//})();

					// Append glTF model to scene.
					(function() {
						//var fname = 'BoomBox.glb';
						var fname = 'Buggy.glb';
						//var fname = 'Duck.gltf';
						//BABYLON.SceneLoader.Append('./res/', 'BoomBox.glb', scene, function (scene) {
						var mesh = BABYLON.SceneLoader.Append('./res/', fname, scene, function (scene) {
							//camera.focusOn(mesh);
						});
					})();

					//lines
					(function() {
						var drawLine = function (name, points, color) {
							var meshLine = BABYLON.Mesh.CreateLines(name, points, scene, true);
							meshLine.color = color;
						};
						var color = new BABYLON.Color3(0.4, 0.4, 0.4);
						var len = 10;

						// Y面
						for(var i = 0; i < 10; i++) {
							v = i + 1;
							//X軸
							drawLine('line', [new BABYLON.Vector3(len, 0,    v), new BABYLON.Vector3(-len, 0,    v)], color);
							drawLine('line', [new BABYLON.Vector3(len, 0,   -v), new BABYLON.Vector3(-len, 0,   -v)], color);
							//Z軸
							drawLine('line', [new BABYLON.Vector3(  v, 0,  len), new BABYLON.Vector3(   v, 0, -len)], color);
							drawLine('line', [new BABYLON.Vector3( -v, 0,  len), new BABYLON.Vector3(  -v, 0, -len)], color);
						}

						//中心軸
						(function() {
							var camQ = camera.rotationQuaternion;
							var revQ = BABYLON.Quaternion.Inverse(camQ || BABYLON.Quaternion.Identity());
							var createTextPlaneMesh = function(text, color, size) {
								var dynamicTexture, plane;
								var dynamicTexture = new BABYLON.DynamicTexture('DynamicTexture', 50, scene, true);
								dynamicTexture.hasAlpha = true;
								dynamicTexture.drawText(text, 5, 40, 'bold 36px Arial', color , 'transparent', true);
								plane = new BABYLON.Mesh.CreatePlane('TextPlane', size, scene, true);
								plane.material = new BABYLON.StandardMaterial('TextPlaneMaterial', scene);
								plane.material.backFaceCulling = false;
								plane.material.specularColor = new BABYLON.Color3(0, 0, 0);
								plane.material.diffuseTexture = dynamicTexture;
								return plane;
							};
							var drawTextPlane = function(text, color, size, pos) {
								var panel = createTextPlaneMesh(text, color, size);
								panel.position = pos;
								panel.rotationQuaternion = revQ;
							};
							drawLine('line', [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3( len,    0,    0)], new BABYLON.Color3(  1, 0.2, 0.2));
							drawLine('line', [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(   0,  len,    0)], new BABYLON.Color3(0.2,   1, 0.2));
							drawLine('line', [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(   0,    0,  len)], new BABYLON.Color3(0.2, 0.2,   1));
							drawLine('line', [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(-len,    0,    0)], color);
							drawLine('line', [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(   0, -len,    0)], color);
							drawLine('line', [new BABYLON.Vector3(0, 0, 0), new BABYLON.Vector3(   0,    0, -len)], color);
							
							drawTextPlane('X', '#FF3333', 1.0, new BABYLON.Vector3( len,    0,    0));
							drawTextPlane('Y', '#33FF33', 1.0, new BABYLON.Vector3(   0,  len,    0));
							drawTextPlane('Z', '#3333FF', 1.0, new BABYLON.Vector3(   0,    0,  len));
						})();
					})();


					// helper
					(function() {
						var helper = scene.createDefaultEnvironment();
						helper.setMainColor(new BABYLON.Color3(0.75, 0.75, 0.75));
					})();

					// option
					(function() {
						var options = new BABYLON.SceneOptimizerOptions();
						var optimizer = new BABYLON.SceneOptimizer(scene, options);
						optimizer.targetFrameRate = 1;
					})();

					// ui
					(function() {
						var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
						var panel = new BABYLON.GUI.StackPanel();
						(function() {
							panel.width = "220px";
							panel.fontSize = "14px";
							panel.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
							panel.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
						})();
						(function() {
							var button = BABYLON.GUI.Button.CreateSimpleButton("button1", "camera reset");
							button.paddingTop = "10px";
							button.paddingBottom = "10px";
							button.width = "100px";
							button.height = "50px";
							button.color = "white";
							button.background = "blue";
							button.onPointerDownObservable.add(function(){
								camera.setTarget(defCameraTgt);
								camera.setPosition(defCameraPos);
							});
							panel.addControl(button);
						})();
						advancedTexture.addControl(panel);
					})();


					//render loop
					engine.runRenderLoop(function(){
						scene.render();
					});

					return scene;
				};
				var init = function() {
					var canvas = document.querySelectorAll("#canvas")[0];
					var engine = new BABYLON.Engine(canvas, true, {preserveDrawingBuffer: true, stencil: true});
					var scene = createScene(engine);
					

					// event handler
					window.addEventListener('resize', function() {
						engine.resize();
					});
				};
				init();
			};
		</script> 
		<style type="text/css">
		<!--
			html, body {
				overflow: hidden;
				width   : 100%;
				height  : 100%;
				margin  : 0;
				padding : 0;
			}
			canvas#canvas {
				width:100%;
				height:100%;
			};
		-->
		</style> 
	</head>
	<body>
		<canvas id="canvas"></canvas>
	</body>
</html>
