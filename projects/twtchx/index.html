<html>
	<head>
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
			<title>twitchx</title>
		<style type="text/css">
		<!--
			@import url(//fonts.googleapis.com/earlyaccess/notosansjp.css);
			@import url(//fonts.googleapis.com/css?family=Inconsolata|Noto+Sans);
			body, div {
				font-family: 'Noto Sans JP', 'Noto Sans', sans-serif;
			}

			body { 
				background-color: #ffffff;
				color: #666666;
			}
			table {
				border-collapse: collapse;
				border-spacing: 0;
				width: 100%;
			}
			table tr{
				border-bottom: solid 1px #eee;
				cursor: pointer;
			}

			table tr:hover{
				background-color: #d4f0fd;
			}

			table th,table td{
				text-align: center;
				width: auto;
				padding: 15px 0;
			}
			
			th.linktwitchx, th.linkmobile, th.linkplayer, th.linkchat
			, td.linktwitchx, td.linkmobile, td.linkplayer, td.linkchat {
				text-align: center;
				width: 100px;
				padding: 15px 0;
			}

			input {
				width: 100%;
			}

		-->
		</style> 
		<script type="text/javascript">
		<!--
			(function() {
				let self = this;
				
				let setLinkTwitchx = function(row, channel) {
					row.querySelectorAll('td.linktwitchx').forEach(function(cell){
						var a = document.createElement('a');
						a.href = './player.html?channel=' + channel;
						a.target = '_blank';
						a.text = '[link]';
						while (cell.firstChild){
							cell.removeChild(cell.firstChild);
						}
						cell.appendChild(a);
					});
				};
				let setLinkMobile = function(row, channel) {
					row.querySelectorAll('td.linkmobile').forEach(function(cell){
						var a = document.createElement('a');
						a.href = 'https://m.twitch.tv/' + channel;
						a.target = '_blank';
						a.text = '[link]';
						while (cell.firstChild){
							cell.removeChild(cell.firstChild);
						}
						cell.appendChild(a);
					});
				};
				let setLinkPlayer = function(row, channel) {
					row.querySelectorAll('td.linkplayer').forEach(function(cell){
						var a = document.createElement('a');
						a.href = 'https://player.twitch.tv/?channel=' + channel + '&muted=false&parent=twitch.tv';
						a.target = '_blank';
						a.text = '[link]';
						while (cell.firstChild){
							cell.removeChild(cell.firstChild);
						}
						cell.appendChild(a);
					});
				};
				let setLinkChat = function(row, channel) {
					row.querySelectorAll('td.linkchat').forEach(function(cell){
						var a = document.createElement('a');
						a.href = 'https://www.twitch.tv/popout/' + channel + '/chat';
						a.target = '_blank';
						a.text = '[link]';
						while (cell.firstChild){
							cell.removeChild(cell.firstChild);
						}
						cell.appendChild(a);
					});
				};

				window.onload = function(){
					/* init. */
					(function() {
						let template = document.querySelectorAll('table.channelTable tbody tr.template')[0];
						let tbody = document.querySelectorAll('table.channelTable tbody')[0];
						if(template && tbody) {
							document.querySelectorAll('contents content').forEach(function(content) {
								let username = content.getAttribute('data-username');
								let channel = content.getAttribute('data-channel');
								let row = template.cloneNode(true);

								tbody.appendChild(row);

								row.classList.remove('template');
								row.removeAttribute('style');
								row.setAttribute('data-username', username);
								row.setAttribute('data-channel', channel);

								row.querySelectorAll('td.username').forEach(function(cell){
									cell.textContent = username;
								});
								if(channel) {
									let linkTwitchx = './player.html?channel=' + channel;
									let linkPlayer = '';
									let linkChat = '';
									row.querySelectorAll('td.channel').forEach(function(cell){
										cell.textContent  = channel;
									});
								}
								setLinkTwitchx(row, channel);
								setLinkMobile(row, channel);
								setLinkPlayer(row, channel);
								setLinkChat(row, channel);
							});
						}
					})();

					/* polling. */
					setInterval(function() {
						document.querySelectorAll('table.channelTable tbody tr').forEach(function(row) {
							row.querySelectorAll('td.channel input').forEach(function(input) {
								if(input.lastValue !== input.value) {
									let channel = input.value;
									let channelEnc = encodeURI(channel);
									setLinkTwitchx(row, channelEnc);
									setLinkMobile(row, channelEnc);
									setLinkPlayer(row, channelEnc);
									setLinkChat(row, channelEnc);
									input.lastValue = input.value;
								}
							});
						});
					}, 1000);
				};
			})();
		-->
		</script> 
	</head>
	<body>
		<h1>twitchx link index</h1>
		<div style="dislay:none;">
			<contents>
				<content data-username='DJ Shimamura' data-channel='djshimamura'></content>
				<content data-username='DJ Noriken' data-channel='dj_noriken'></content>
				<content data-username='Abitan' data-channel='abitankh'></content>
				<content data-username='ROCKUP! CREW' data-channel='rockuphardcrew'></content>
				<content data-username='MOGRA' data-channel='mogra'></content>
				<content data-username='204' data-channel='204nws'></content>
				<content data-username='Sound Arium' data-channel='soundarium'></content>
				<content data-username='たけやま' data-channel='0ha3ru1ka4'></content>
				<content data-username='WARP新宿' data-channel='warp2onelive'></content>
				<content data-username='choroyama' data-channel='choroyama'></content>
				<content data-username='hara' data-channel='haraqlo'></content>
				<content data-username='aggressive_war' data-channel='aggressive_war'></content>
				<content data-username='ohr_party' data-channel='ohr_party'></content>
				<content data-username='terminal__x' data-channel='terminal__x'></content>
				<content data-username='otaquest' data-channel='otaquest'></content>
				<content data-username='DJ Brisk' data-channel='DJBrisk'></content>
			</contents>
		</div>
		<table class='channelTable'>
			<thead>
				<tr>
					<th class="username">username</th>
					<th class="channel">channel</th>
					<th class="linktwitchx">twitchx</th>
					<th class="linkmobile">mobile</th>
					<th class="linkplayer">player</th>
					<th class="linkchat">chat</th>
				</tr>
			</thead>
			<tbody>
				<!-- template. -->
				<tr class="template" style="display:none">
					<td class="username"></td>
					<td class="channel"><input type="text"></td>
					<td class="linktwitchx"></td>
					<td class="linkmobile"></td>
					<td class="linkplayer"></td>
					<td class="linkchat"></td>
				</tr>
				<!-- n/a. -->
				<tr data-username='n/a' data-channel=''>
					<td class="username">n/a</td>
					<td class="channel"><input type="text"></td>
					<td class="linktwitchx"></td>
					<td class="linkmobile"></td>
					<td class="linkplayer"></td>
					<td class="linkchat"></td>
				</tr>
			</tbody>
		</table>
		<hr>
		<a href="../">back</a>
	</body>
<html>